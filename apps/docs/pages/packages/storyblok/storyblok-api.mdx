import { Steps } from 'nextra/components';

# @natu/storyblok-api

## ðŸ’» Storyblok API

A package to connect to Storyblok CMS API and fetch data.

It uses:

- [GraphQL](https://graphql.org/) query language
- [codegen â†—](https://the-guild.dev/graphql/codegen) to generate types

## ðŸ¤“ Usage

<Steps>
  ### Import package as a dependency in `package.json` file

```json
"dependencies": {
  "@natu/storyblok-api": "*",
}
```

### Use it to connect to Storyblok and fetch data from it

```tsx filename="/apps/web/src/app/page.tsx" {3,8,12}
import { draftMode } from 'next/headers';
import { notFound } from 'next/navigation';
import { relations, getStoryblokApi } from '@natu/storyblok-api';
import { DynamicRender } from '@natu/storyblok-utils';

const Page = async () => {
  const { isEnabled } = draftMode();
  const { getContentNode } = getStoryblokApi({ draftMode: isEnabled });

  const story = await getContentNode({
    slug: env.NEXT_PUBLIC_STORYBLOK_MAIN_APP_FOLDER,
    relations,
  });

  if (!story || !story?.ContentNode) {
    return notFound();
  }

  return <DynamicRender data={story.ContentNode.content} />;
};

export default Page;
```

</Steps>

## Folders & files included

### generated

A folder for files auto-generated by `codegen` basing on `codegen.ts` configuration file in root folder of the package.
You can see all configuration options in the [codegen documentation â†—](https://the-guild.dev/graphql/codegen/docs/config-reference/codegen-config).

### graphql

A folder for all `.graphql` files like queries, fragments, etc. The types in `generated` folder are auto-generated
basing on those. Already includes queries:

- `getConfigItem` - get the configuration (header, footer, notFound page etc.)
- `getContentNodeQuery` - get the single story by slug
- `getContentNodesQuery` - get stories with optional params (ex. sorting, filtering)
- `getLinksQuery` - tbd

### hooks

A folder for all reusable hooks. Already includes:

#### useStoryblokSdk

tbd

### api.ts

Contains the most generic and important function of this package: `getStoryblokApi`. Usage:

```tsx filename="/apps/web/src/app/page.tsx" /getStoryblokApi/
import { relations, getStoryblokApi } from '@natu/storyblok-api';

const { getContentNode } = getStoryblokApi({ <options, ex. draftMode> });

const story = await getContentNode({ slug: ..., relations });
```

### relations.ts

Contains the relations between stories (tbd - add more details). Usage:

```tsx filename="/apps/web/src/app/page.tsx" /relations/
import { relations, getStoryblokApi } from '@natu/storyblok-api';

const { getContentNode } = getStoryblokApi({ <options, ex. draftMode> });

const story = await getContentNode({ slug: ..., relations });
```

### sdk.ts

Contains `getSdk` function and some connected types. Already used in [api.ts](/packages/storyblok/storyblok-api#apits)
file of this package. Usage:

```tsx /SdkFunctionWrapper/ /getSdk/ /Sdk/
import { env } from '@natu/env';
import { ApiFetcher } from '@natu/next-api-fetcher';
import { type Sdk, SdkFunctionWrapper, type getSdk } from '@natu/storyblok-api';

const { fetcher } = new ApiFetcher(
  storyblokApiUrl,
  {<fetch options ex. headers, cache>}
);

export const getStoryblokApi = (): Sdk  => {
  const wrapper: SdkFunctionWrapper = action => {
    return action({ <fetch options ex. headers, cache> });
  };

  return getSdk(fetcher, wrapper);
};xs
```

### tags.ts

Contains tags which can be used ex. for
[Next request revalidation â†—](https://nextjs.org/docs/app/building-your-application/data-fetching/fetching-caching-and-revalidating#on-demand-revalidation).
Example usage:

```tsx {14} /TAGS,/
import { TAGS, getStoryblokApi, relations } from '@natu/storyblok-api';

const { getConfigNode } = getStoryblokApi({ draftMode: isEnabled });

const configData = await getConfigNode(
  {
    slug: configSlug,
    skipNotFoundPage: true,
    skipSeo: true,
    relations,
  },
  {
    next: {
      tags: [TAGS.SB_CONFIG],
    },
  },
);
```
